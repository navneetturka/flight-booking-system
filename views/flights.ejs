<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title><%= title || 'Flights' %></title>
    <link rel="stylesheet" href="/css/style.css" />
    <script src="/js/script.js" defer></script>
  </head>
  <body>
    <% if (typeof user !== 'undefined' && user) { %>
      <nav class="navbar">
        <div class="brand">
          <div class="logo">✈</div>
          <div class="title">SkyReserve</div>
        </div>
        <div class="realtime-indicator" data-realtime-indicator data-status="offline">
          <span class="realtime-dot"></span>
          <span data-realtime-label>Offline</span>
        </div>
        <div class="links">
          <a href="/">Dashboard</a>
          <a href="/flights">Flights</a>
          <a href="/bookings">My Bookings</a>
          <% if (user.role === 'admin') { %>
            <a href="/bookings/all">All Bookings</a>
          <% } %>
          <form method="post" action="/logout" style="margin:0">
            <button class="logout-btn" type="submit">Logout</button>
          </form>
        </div>
      </nav>
    <% } %>
    <div class="container-top">
      <div class="auth-card" style="max-width:1200px;width:100%">
        <h1 class="auth-title">Flights</h1>
        <div class="flight-list">
          <% (flights || []).forEach(f => { %>
            <div class="flight-card">
              <div class="flight-left">
                <div class="flight-airline"><%= f.number %></div>
                <div class="flight-route"><%= f.origin %> → <%= f.destination %></div>
              </div>
              <div class="flight-mid">
                <div class="time">Depart <%= f.departAt %></div>
                <div>Arrive <%= f.arriveAt %></div>
              </div>
              <div class="flight-right">
                <div class="price">$<%= f.price %></div>
                <% if (typeof user !== 'undefined' && user.role === 'admin') { %>
                  <form method="post" action="/flights/<%= f.id %>/delete">
                    <button class="btn-primary" type="submit" style="background:var(--danger);color:white;width:120px">Delete</button>
                  </form>
                <% } else { %>
                  <form method="post" action="/bookings">
                    <input type="hidden" name="flightId" value="<%= f.id %>" />
                    <button class="btn-primary" type="submit" style="width:120px">Book</button>
                  </form>
                <% } %>
              </div>
            </div>
          <% }) %>
        </div>

        <% if (typeof user !== 'undefined' && user.role === 'admin') { %>
          <% const _edit = (typeof editFlight !== 'undefined' && editFlight) ? editFlight : null; %>
          <h2 class="auth-title" style="margin-top:18px;text-align:center"><%= _edit ? 'Modify flight' : 'Add flight' %></h2>
          <form class="form center-form" method="post" action="<%= _edit ? ('/flights/' + _edit.id) : '/flights' %>">
            <div class="field"><label>Number</label><input name="number" value="<%= _edit ? _edit.number : '' %>" required /></div>
            <div class="field"><label>Origin</label><input name="origin" value="<%= _edit ? _edit.origin : '' %>" required /></div>
            <div class="field"><label>Destination</label><input name="destination" value="<%= _edit ? _edit.destination : '' %>" required /></div>
            <div class="field"><label>Depart</label><input name="departAt" type="datetime-local" value="<%= _edit ? String(_edit.departAt).replace(' ', 'T').slice(0,16) : '' %>" placeholder="2025-10-01T08:00" required /></div>
            <div class="field"><label>Arrive</label><input name="arriveAt" type="datetime-local" value="<%= _edit ? String(_edit.arriveAt).replace(' ', 'T').slice(0,16) : '' %>" placeholder="2025-10-01T11:00" required /></div>
            <div class="field"><label>Price</label><input name="price" type="number" step="0.01" value="<%= _edit ? _edit.price : '' %>" required /></div>
            <button class="btn-primary" type="submit"><%= _edit ? 'Save changes' : 'Create' %></button>
          </form>
        <% } %>
      </div>
    </div>
  </body>
</html>
